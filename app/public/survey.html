<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Reservation Page</title>

	<!-- Latest compiled and minified CSS & JS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

</head>
<body>
	<div class="container">
		<div class="jumbotron">
			<h1 class="text-center"><img src="images/kites.png">Compatibility Survey</h1>
			<hr>
			<h2 class="text-center"></h2>
			<br>

			<div class="text-center">
				<a href="/tables"><button type="button" class="btn btn-lg btn-primary"><span class="glyphicon glyphicon-list-alt"></span> View Tables</button></a>
				<a href="/"><button type="button" class="btn btn-lg btn-default"><span class="glyphicon glyphicon-home"></span></button></a>		
			</div>
		</div>

		<div class="row">
			<div class="col-lg-12">

				<div class="panel panel-default">
					<div class="panel-heading">
						<h4 class="panel-title">Table Reservation</h4>
					</div>
					<div class="panel-body">

						<form role="form">
							
							<div class="form-group">
								<label for="">Name</label>
								<input type="text" class="form-control" id="friend_name">
							</div>

							<div class="form-group">
								<label for="">Phone Number</label>
								<input type="text" class="form-control" id="friend_phone">
							</div>

							<div class="form-group">
								<h3><strong>Question 1</strong></h3>
								<h4>Are you a Republican, Libertarian, Independant, Democratic, Green?</h4>
								<select data-placeholder="" class="chosen-select" id="q1">
									<option value=""></option>
									<option value="1">1 (Republican)</option>
									<option value="2">2 (Libertarian)</option>
									<option value="3">3 (Independant)</option>
									<option value="4">4 (Democratic)</option>
									<option value="5">5 (Green)</option>
								</select>								
							</div>
							<div class="form-group">
								<h3><strong>Question 2</strong></h3>
								<h4>Is going to a shooting range high on your list of fun things to do?</h4>
								<select data-placeholder="" class="chosen-select" id="q2">
									<option value=""></option>
									<option value="1">1 (Strongly Disagree)</option>
									<option value="2">2</option>
									<option value="3">3</option>
									<option value="4">4</option>
									<option value="5">5 (Strongly Agree)</option>
								</select>								
							</div>
							<div class="form-group">
								<h3><strong>Question 3</strong></h3>
								<h4>Where ?</h4>
								<select data-placeholder="" class="chosen-select" id="q3">
									<option value=""></option>
									<option value="1">1</option>
									<option value="2">2</option>
									<option value="3">3</option>
									<option value="4">4</option>
									<option value="5">5</option>
								</select>								
							</div>

							<div class="form-group">
								<label for="">Unique ID</label>
								<input type="text" class="form-control" id="reserve_uniqueID">
							</div>

							<button type="submit" class="btn btn-primary submit">Submit</button>
						</form>

					</div>
				</div>
				
			</div>
		</div>


		<footer class="footer">
			<!-- <div class="container">
				<p><a href="/api/tables">API Table Link</a> | <a href="/api/waitlist">API Wait List</a> | <a href="https://github.com/afhaque/HotRestaurant">GitHub Repo</a></p>
			</div> -->
		</footer>

	</div>
	
</body>
</html>

<script type="text/javascript">

	$(".submit").on("click", function(e){
		e.preventDefault();
		// Here we grab the form elements
		var newScore = $('.chosen-select');
		var newFriend = {
			friendName: $('#friend_name').val().trim(),
			phoneNumber: $('#friend_phone').val().trim(),
			scores: [],
			
		};

		console.log(newScore);
		for(var i = 0; i < newScore.length; i++){
			newFriend.scores.push(newScore[i].value);
		}
		console.log(newFriend)

		// This line is the magic. It's very similar to the standard ajax function we used. 
		// Essentially we give it a URL, we give it the object we want to send, then we have a "callback".
		// The callback is the response of the server. In our case, we set up code in api-routes that "returns" true or false
		// depending on if a tables is available or not. 

		// Here we get the location of the root page. 
		// We use this instead of explicitly saying the URL is localhost:3001 because the url will change when we deploy.
		var currentURL = window.location.origin;

		$.post(currentURL + "/api/survey", newFriend,
			function(data){

	    	// If a table is available... tell user they are booked.
	    	if(data == true){
	    		alert("Yay! You are officially booked!")
	    	}

	    	// If a table is available... tell user they on the waiting list.
	    	if(data == false){
	    		alert("Sorry you are on the wait list")
	    	}

	    	// Clear the form when submitting
	    	/*$('#reserve_name').val("");
	    	$('#reserve_phone').val("");
	    	$('#reserve_email').val("");
	    	$('#reserve_uniqueID').val("");*/

	    });

	});

</script>